{% extends 'base-seller.html' %}

{% block content %}

<div class="inventory-container">
    <h1>Inventory Management</h1>

    <!-- Add Product Section -->
    <div class="add-product">
        <h2>Add Product</h2>
        <form id="add-product-form" action="/add-product" method="POST" enctype="multipart/form-data">
            <!-- Form fields for adding a product -->
            <div class="form-group">
                <label for="product-name">Product Name</label>
                <input type="text" name="product-name" id="product-name" placeholder="Product Name" required>
            </div>
            <div class="form-group">
                <label for="product-price">Price</label>
                <input type="number" name="product-price" id="product-price" placeholder="Price" required>
            </div>
            <div class="form-group">
                <label for="product-stock">Quantity</label>
                <input type="number" name="product-stock" id="product-stock" placeholder="Stock" required>
            </div>
            <div class="form-group">
                <label for="product-category">Category</label>
                <select name="product-category" id="product-category" required>
                    <option value="Shirts">Shirts</option>
                    <option value="Pants">Pants</option>
                    <option value="Dresses">Dresses</option>
                    <option value="Outerwear">Outerwear</option>
                    <option value="Accessories">Accessories</option>
                </select>
            </div>
            <div class="form-group">
                <label for="product-subcategory">Sub-category</label>
                <select name="product-subcategory" id="product-subcategory" required>
                    <!-- Sub-categories will be populated dynamically based on the selected category -->
                </select>
            </div>
            <div class="form-group">
                <label for="product-condition">Condition</label>
                <select name="product-condition" id="product-condition" required>
                    <option value="New">New</option>
                    <option value="Like New">Like New</option>
                    <option value="Good">Good</option>
                    <option value="Fair">Fair</option>
                    <option value="Vintage">Vintage</option>
                </select>
            </div>
            <div class="form-group">
                <label for="product-size">Size</label>
                <input type="text" name="product-size" id="product-size" placeholder="Size (e.g., M, L, etc.)" required>
            </div>
            <div class="form-group">
                <label for="product-description">Description</label>
                <textarea id="product-description" name="product-description" placeholder="Description" required></textarea>
            </div>
            <div class="form-group">
                <label for="product-image">Image</label>
                <input type="file" id="product-image" name="product-image">
            </div>
            <button type="submit" class="btn">Add Product</button>
        </form>
    </div>

    <!-- Active Products Section -->
    <div class="product-section">
        <h2>Active Products</h2>
        <table>
            <thead>
                <tr>
                    <th>Product Name</th>
                    <th>Price</th>
                    <th>Quantity</th>
                    <th>Category</th>
                    <th>Condition</th>
                    <th>Description</th>
                    <th>Image</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="active-products-body">
                {% for product in products if product['product_status'] == 'active' %}
                <tr>
                    <td>{{ product['product_name'] }}</td>
                    <td>${{ product['product_price'] }}</td>
                    <td>{{ product['product_stock'] }}</td>
                    <td>{{ product['product_category'] }}</td>
                    <td>{{ product['product_condition'] }}</td>
                    <td>{{ product['product_description'] }}</td>
                    <td>
                        {% if product['product_image'] %}
                            <img src="{{ url_for('static', filename='uploads/products/' + product['product_image'].replace('\\', '/')) }}" 
                                 alt="{{ product['product_name'] }}" width="50">
                        {% else %}
                            <span>No Image</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ url_for('update_product', product_id=product['product_id']) }}" class="btn btn-warning">Update</a>
                        <form action="{{ url_for('toggle_product_status', product_id=product['product_id']) }}" method="POST" style="display:inline;">
                            <button type="submit" class="btn btn-warning">Archive</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Archived Products Section -->
    <div class="product-section">
        <h2>Archived Products</h2>
        <table>
            <thead>
                <tr>
                    <th>Product Name</th>
                    <th>Price</th>
                    <th>Quantity</th>
                    <th>Category</th>
                    <th>Condition</th>
                    <th>Description</th>
                    <th>Image</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="archived-products-body">
                {% for product in products if product['product_status'] == 'archived' %}
                <tr>
                    <td>{{ product['product_name'] }}</td>
                    <td>${{ product['product_price'] }}</td>
                    <td>{{ product['product_stock'] }}</td>
                    <td>{{ product['product_category'] }}</td>
                    <td>{{ product['product_condition'] }}</td>
                    <td>{{ product['product_description'] }}</td>
                    <td>
                        {% if product['product_image'] %}
                            <img src="{{ url_for('static', filename='uploads/products/' + product['product_image'].replace('\\', '/')) }}" 
                                 alt="{{ product['product_name'] }}" width="50">
                        {% else %}
                            <span>No Image</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ url_for('update_product', product_id=product['product_id']) }}" class="btn btn-success">Update</a>
                        <form action="{{ url_for('toggle_product_status', product_id=product['product_id']) }}" method="POST" style="display:inline;">
                            <button type="submit" class="btn btn-success">Unarchive</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Additional Sections at the Bottom -->
    <!-- Bulk Actions Section -->
    <div class="bulk-actions">
        <select>
            <option>Bulk Actions</option>
            <option>Update Stock</option>
            <option>Update Price</option>
            <option>Apply Discount</option>
        </select>
        <button class="btn">Apply</button>
    </div>

    <!-- Low Stock Alerts Section -->
    <div class="low-stock-alerts">
        <h2>Low Stock Alerts</h2>
        <p>Product 3 is low on stock. Only 5 left!</p>
    </div>

    <!-- Export Inventory Section -->
    <div class="export-inventory">
        <button class="btn">Export to CSV</button>
        <button class="btn">Export to Excel</button>
    </div>

    <!-- Sales Analysis Section -->
    <div class="sales-analysis">
        <h2>Sales Analysis</h2>
        <p>Sales trends and analytics for each product will be displayed here.</p>
    </div>

</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById('add-product-form');
        const categorySelect = document.getElementById('product-category');
        const subCategorySelect = document.getElementById('product-subcategory');
        
        const subCategories = {
            'Shirts': ['Casual', 'Formal', 'Sports'],
            'Pants': ['Jeans', 'Trousers', 'Shorts'],
            'Dresses': ['Maxi', 'Mini', 'Midi'],
            'Outerwear': ['Jackets', 'Coats', 'Blazers'],
            'Accessories': ['Hats', 'Bags', 'Shoes']
        };
        
        // Function to update sub-categories based on selected category
        const updateSubCategories = () => {
            const selectedCategory = categorySelect.value;
            const subCategoryOptions = subCategories[selectedCategory] || [];
            subCategorySelect.innerHTML = ''; // Clear existing options
            subCategoryOptions.forEach(subCat => {
                const option = document.createElement('option');
                option.value = subCat;
                option.textContent = subCat;
                subCategorySelect.appendChild(option);
            });
        };

        // Call the function initially to populate sub-categories for the default selected category
        updateSubCategories();
        
        // Update sub-categories when the category changes
        categorySelect.addEventListener('change', updateSubCategories);
        
        // Handle form submission using Fetch
        form.addEventListener('submit', function(e) {
            e.preventDefault();  // Prevent default form submission

            const formData = new FormData(form);

            fetch('/add-product', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    window.location.reload();  // Reload page after successful product addition
                } else {
                    alert('Failed to add product. Please try again.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error adding product. Please try again.');
            });
        });
    });
</script>

{% endblock %}
